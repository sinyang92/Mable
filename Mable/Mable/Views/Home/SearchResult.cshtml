@{
    ViewBag.Title = "Search result";
    //Layout = "~/Views/Shared/_LayoutSearch.cshtml";
}


@model List<Mable.Classes.PlaceDetail.Result>

@using PagedList.Mvc

<style>
    /*#map {
        height: 100%;
    }

    html.body {
        height: 100%;
        margin: 0;
        padding: 0;
    }*/


</style>
<script>
    var map;
    var service;
    var infowindow;



    function initialize() {
        var pyrmont = new google.maps.LatLng(-37.812479, 144.96150);

        map = new google.maps.Map(document.getElementById('map'), {
            center: pyrmont,
            zoom: 15
        });

        var keyword = '@ViewBag.searchKeyWord';
        var request = {
            location: pyrmont,
            radius: '500',
            query: keyword
        };

        infowindow = new google.maps.InfoWindow()
        service = new google.maps.places.PlacesService(map);
        service.textSearch(request, callback);
    }

    function callback(results, status) {
        //TODO: GET buildings from view and compare
        //var buildings = '@ViewBag.buildings'
        if (status == google.maps.places.PlacesServiceStatus.OK) {
            for (var i = 0; i < results.length; i++) {
                var place = results[i];
                createMarker(results[i]);
                listResult(place);
            }
        }
    }

    function createMarker(place) {
        var placeLoc = place.geometry.location;
        var marker = new google.maps.Marker({
            map: map,
            position: place.geometry.location,
            visible: true,
        });
        marker.setMap(map);

        google.maps.event.addListener(marker, 'click', function () {
            infowindow.setContent(place.name);
            infowindow.open(map, this);
        });
    }

    function listResult(place) {

    }
</script>

<!-- Search -->

<div class="row">

    <div class="mable-homeSearch col-md-12 text-center">

        <div class="title">Search</div>

        @using (Html.BeginForm("SearchResult", "Home"))

        {

            @Html.TextBox("keyword", "", new { placeholder = "Find restaurants, stores, and more", id = "SearchBox" })

        }





    </div>

</div>
<!--End Search -->

<div class="row">


    @if (ViewBag.HasResult == false)
    {
        <!--Start No Results Message -->
        <div class="col-sm-8 col-sm-offset-2">
            No result
        </div>
    }


    @foreach (var item in Model)
    {
        <div class="col-sm-8 col-sm-offset-2  mable-CardResult">
            <div class="row">
                <a href="@Url.Action("ResultDetail", new { id = item.id })">
                    <figcaption class="col-lg-8">
                        <h1 class="mable-CardResult-title">
                            @item.name
                        </h1>
                        <div class="mable-CardResult-address">
                            @*@item.formatted_address*@
                            @item.vicinity
                        </div>
                        <i class="fas fa-star"></i> @item.rating
                    </figcaption>
                    <div class="col-lg-2">
                        <div class="mable-CardResult-accRating">
                            <p>Accessibility Rating</p>

                            <i class="fas fa-universal-access" style="font-size: 28px;">
                                @item.accessibility_rating
                            </i>
                        </div>

                    </div>
                    <div class="col-lg-2">
                        <i class="fas fa-info-circle"> </i> @Html.ActionLink(" Check more", "ResultDetail", new { id = item.id })

                    </div>
                </a>
            </div>
        </div>
    }
</div>


<!--
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgWw5yvhJAS5LsXo2RGJa0o-cPWMNNPLo&libraries=places&callback=initialize"></script>
-->
